<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="mutate_expecvar() uses a new expected rate for a decrement of interest and
adds a corresponding expected decrements column and corresponding variance
of expected decrements column. If there are already expecteds and variances
measures within the study dataset, either new, prefixed columns will be
added or the current expecteds and variances can be overwritten."><title>Add new expecteds and variances to an experience study — mutate_expecvar • expstudy</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add new expecteds and variances to an experience study — mutate_expecvar"><meta property="og:description" content="mutate_expecvar() uses a new expected rate for a decrement of interest and
adds a corresponding expected decrements column and corresponding variance
of expected decrements column. If there are already expecteds and variances
measures within the study dataset, either new, prefixed columns will be
added or the current expecteds and variances can be overwritten."><meta property="og:image" content="https://cb12991.github.io/expstudy/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">expstudy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cb12991/expstudy/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add new expecteds and variances to an experience study</h1>
      <small class="dont-index">Source: <a href="https://github.com/cb12991/expstudy/blob/HEAD/R/mutate_expecvar.R" class="external-link"><code>R/mutate_expecvar.R</code></a></small>
      <div class="d-none name"><code>mutate_expecvar.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>mutate_expecvar()</code> uses a new expected rate for a decrement of interest and
adds a corresponding expected decrements column and corresponding variance
of expected decrements column. If there are already expecteds and variances
measures within the study dataset, either new, prefixed columns will be
added or the current expecteds and variances can be overwritten.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mutate_expecvar</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">new_expected_rates</span>,</span>
<span>  new_expecvar_prefix <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  measure_sets <span class="op">=</span> <span class="fu"><a href="guess_measure_sets.html">guess_measure_sets</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span>,</span>
<span>  amount_scalar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"used"</span>, <span class="st">"unused"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  .before <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .after <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.data</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">base::data.frame()</a></code> that houses an experience study.</p></dd>


<dt>new_expected_rates</dt>
<dd><p>A numeric vector to use as the expected probability for the study's event
of interest (i.e., policy lapse or insured death). This can be a column
in the dataset or a new numeric vector of length 1 or <code>nrow(.data)</code>.</p></dd>


<dt>new_expecvar_prefix</dt>
<dd><p>A string to distinguish the new expecteds and variances columns in the
dataset. To overwrite existing expecteds and variances columns, use an
argument value of <code>NULL</code>, <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>, or <code>''</code>. The default <code>'auto'</code> will
add a numeric prefix based on the previous names of expecteds/variances so
that names will remain unique.</p></dd>


<dt>measure_sets</dt>
<dd><p>A (potentially named) list of measure sets. Only need to specify once if
chaining multiple <code>expstudy</code> functions as the <code>measure_sets</code> will be
passed as an attribute in results.</p></dd>


<dt>amount_scalar</dt>
<dd><p>A numeric vector to use when determining amount-weighted expecteds and
variances. The function will determine whether or not the new
expecteds/variances are amount-weighted if the corresponding actuals in
the study have values greater than 1 (actuals that are not
amount-weighted, i.e., counts, should only be 0 or 1).</p></dd>


<dt>.by</dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>&lt;<code><a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidy-select</a></code>&gt; Optionally, a selection of columns to
group by for just this operation, functioning as an alternative to <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>. For
details and examples, see <a href="https://dplyr.tidyverse.org/reference/dplyr_by.html" class="external-link">?dplyr_by</a>.</p></dd>


<dt>.keep</dt>
<dd><p>Control which columns from <code>.data</code> are retained in the output. Grouping
columns and columns created by <code>...</code> are always kept.</p><ul><li><p><code>"all"</code> retains all columns from <code>.data</code>. This is the default.</p></li>
<li><p><code>"used"</code> retains only the columns used in <code>...</code> to create new
columns. This is useful for checking your work, as it displays inputs
and outputs side-by-side.</p></li>
<li><p><code>"unused"</code> retains only the columns <em>not</em> used in <code>...</code> to create new
columns. This is useful if you generate new columns, but no longer need
the columns used to generate them.</p></li>
<li><p><code>"none"</code> doesn't retain any extra columns from <code>.data</code>. Only the grouping
variables and columns created by <code>...</code> are kept.</p></li>
</ul></dd>


<dt>.before, .after</dt>
<dd><p>&lt;<code><a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html" class="external-link">tidy-select</a></code>&gt; Optionally, control where new columns
should appear (the default is to add to the right hand side). See
<code><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate()</a></code> for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of the same type as <code>.data</code>. The output has the following
properties:</p><ul><li><p>Columns from <code>.data</code> will be preserved according to the <code>.keep</code> argument.</p></li>
<li><p>Existing columns that are modified by <code>...</code> will always be returned in
their original location.</p></li>
<li><p>New columns created through <code>...</code> will be placed according to the
<code>.before</code> and <code>.after</code> arguments.</p></li>
<li><p>The number of rows is not affected.</p></li>
<li><p>Columns given the value <code>NULL</code> will be removed.</p></li>
<li><p>Groups will be recomputed if a grouping variable is mutated.</p></li>
<li><p>Data frame attributes are preserved.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="underlying-assumptions">Underlying Assumptions<a class="anchor" aria-label="anchor" href="#underlying-assumptions"></a></h2>
    <p>This function was developed according to current industry practice relating
to experience study calculations. Some of the assumptions incorporated are
briefly outlined below.</p><ol><li><p>The experience study data is at a seriatim level where repeated
observations of multiple units can exist. For example, the study data can
contain experience for multiple policies over multiple calendar or policy
years.</p></li>
<li><p>Each decrement event can be described as a Bernoulli random variable with
expected rate of decrement equal to $p$. Furthermore, combining multiple
observation units with equal rates of decrement $p$ can be considered a
Binomial random variable with $n$ equal to the number of observation units.</p></li>
<li><p>Decrements are considered to be uniform between observations.</p></li>
</ol><p>With these assumptions, new expecteds that are not amount-weighted are
calculated as the product of exposures and the expected decrement rate, new
variances are calculated as the product of the previously calculated new
expecteds and 1 minus the previously calculated new expecteds.
Amount-weighted expecteds and variances follow the prior calculations and
additionally multiply by the amount scalar and amount scalar squared,
respectively.</p>
<p>For a more detailed explanation of these methods used, please refer to the
<a href="https://www.soa.org/globalassets/assets/Files/Research/2016-10-experience-study-calculations.pdf" class="external-link">Society of Actuary's publication over experience study calculations</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="naming-convention">Naming convention<a class="anchor" aria-label="anchor" href="#naming-convention"></a></h2>
    


<p><code>expstudy</code> uses a naming convention where some functions are prefixed by the
underling <code>dplyr</code> verb. The purpose of this is to associate the resulting
structure of the <code>expstudy</code> function with a very similar output as what the
<code>dplyr</code> function would produce. Note that the intention here is not replace
all <code>dplyr</code> use cases but instead add specific functionality to streamline
routine experience study analyses.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mortexp</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    NEW_EXPECTED_MORT_RT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mortexp</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">mutate_expecvar</span><span class="op">(</span></span></span>
<span class="r-in"><span>    new_expected_rates <span class="op">=</span> <span class="va">NEW_EXPECTED_MORT_RT</span>,</span></span>
<span class="r-in"><span>    new_expecvar_prefix <span class="op">=</span> <span class="st">'ADJ_'</span>,</span></span>
<span class="r-in"><span>    amount_scalar <span class="op">=</span> <span class="va">FACE_AMOUNT</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 176,096 × 28</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    AS_OF_DATE POLICY_HOLDER GENDER SMOKING_STATUS UNDERWRITING_CLASS FACE_AMOUNT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 1998-04-30 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 1998-05-31 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 1998-06-30 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 1998-07-31 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 1998-08-31 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 1998-09-30 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 1998-10-31 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 1998-11-30 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 1998-12-31 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 1999-01-31 PH_0001       FEMALE NON-SMOKER     STANDARD                  <span style="text-decoration: underline;">5</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 176,086 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 22 more variables: INSURED_DOB &lt;date&gt;, ISSUE_DATE &lt;date&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   TERMINATION_DATE &lt;date&gt;, ISSUE_AGE &lt;dbl&gt;, ATTAINED_AGE &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   EXPECTED_MORTALITY_RT &lt;dbl&gt;, POLICY_DURATION_YR &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   POLICY_DURATION_MNTH &lt;int&gt;, POLICY_STATUS &lt;fct&gt;, MORT_EXPOSURE_CNT &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   MORT_EXPOSURE_AMT &lt;dbl&gt;, MORT_ACTUAL_CNT &lt;dbl&gt;, MORT_ACTUAL_AMT &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   MORT_EXPECTED_CNT &lt;dbl&gt;, MORT_EXPECTED_AMT &lt;dbl&gt;, …</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Cody Buehler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

