<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Add commonly used metrics to an expstudy(). This typically would be after
grouping by variables of interest, but doesn't have to be. The following
metrics are available by default and use the expstudy's metric variables
(actuals, expecteds, andexposures).
'act2expec': actuals to expecteds (i.e., A/E ratios)
'act2expos': actuals to exposures (i.e., average actually observed)
'expec2expos': expecteds to exposures (i.e., average expected)


You can also create custom metrics to add by providing (optionally named)
metric formulae."><title>Add Metrics — add_metrics • expstudy</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add Metrics — add_metrics"><meta property="og:description" content="Add commonly used metrics to an expstudy(). This typically would be after
grouping by variables of interest, but doesn't have to be. The following
metrics are available by default and use the expstudy's metric variables
(actuals, expecteds, andexposures).
'act2expec': actuals to expecteds (i.e., A/E ratios)
'act2expos': actuals to exposures (i.e., average actually observed)
'expec2expos': expecteds to exposures (i.e., average expected)


You can also create custom metrics to add by providing (optionally named)
metric formulae."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">expstudy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cb12991/expstudy/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Add Metrics</h1>
      <small class="dont-index">Source: <a href="https://github.com/cb12991/expstudy/blob/HEAD/R/add_metrics.R" class="external-link"><code>R/add_metrics.R</code></a></small>
      <div class="d-none name"><code>add_metrics.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add commonly used metrics to an <code><a href="expstudy.html">expstudy()</a></code>. This typically would be after
grouping by variables of interest, but doesn't have to be. The following
metrics are available by default and use the <code>expstudy</code>'s metric variables
(<code>actuals</code>, <code>expecteds</code>, and<code>exposures</code>).</p><ul><li><p><code>'act2expec'</code>: actuals to expecteds (i.e., A/E ratios)</p></li>
<li><p><code>'act2expos'</code>: actuals to exposures (i.e., average actually observed)</p></li>
<li><p><code>'expec2expos'</code>: expecteds to exposures (i.e., average expected)</p></li>
</ul><p>You can also create custom metrics to add by providing (optionally named)
metric formulae.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">add_metrics</span><span class="op">(</span>
  <span class="va">expstudy</span>,
  <span class="va">...</span>,
  .metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"act2expec"</span>, <span class="st">"act2expos"</span>, <span class="st">"expec2expos"</span><span class="op">)</span>,
  .metric_nms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>act2expec <span class="op">=</span> <span class="st">"ACTUAL_TO_EXPECTED"</span>, act2expos <span class="op">=</span> <span class="st">"ACTUAL_TO_EXPOSED"</span>,
    expec2expos <span class="op">=</span> <span class="st">"EXPECTED_TO_EXPOSED"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>expstudy</dt>
<dd><p>an <code><a href="expstudy.html">expstudy()</a></code></p></dd>
<dt>...</dt>
<dd><p>additional metrics to add. Can be name-value pairs or simply the
metric's formula.</p></dd>
<dt>.metrics</dt>
<dd><p>default methods to add; if omitted, all metrics listed will
be added</p></dd>
<dt>.metric_nms</dt>
<dd><p>pairlist of .metric names; can be character vector for
<code>expstudy</code> object with multiple columns per <code>.metrics</code> argument</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>expstudy</code> object with added metrics. See <code><a href="expstudy.html">expstudy()</a></code> for
additional detail on <code>expstudy</code> objects.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in">  <span class="va">es</span> <span class="op">&lt;-</span> <span class="fu"><a href="expstudy.html">expstudy</a></span><span class="op">(</span></span>
<span class="r-in">    data <span class="op">=</span> <span class="va">mortexp</span>,</span>
<span class="r-in">    actuals <span class="op">=</span> <span class="va">ACTUAL_DEATHS</span>,</span>
<span class="r-in">    expecteds <span class="op">=</span> <span class="va">EXPECTED_DEATHS</span>,</span>
<span class="r-in">    exposures <span class="op">=</span>  <span class="va">EXPOSURE</span>,</span>
<span class="r-in">    variances <span class="op">=</span> <span class="va">VARIANCE_DEATHS</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># If no arguments are provided, all default metrics will be generated. This</span></span>
<span class="r-in">  <span class="co"># mostly makes sense for already aggregated expstudy objects, but can be used</span></span>
<span class="r-in">  <span class="co"># with unaggregated objects as well.</span></span>
<span class="r-in">   <span class="va">es</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">     <span class="fu"><a href="aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">ATTAINED_AGE</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">     <span class="va">add_metrics</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Source: </span>local data table [83 x 8]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Call:   </span>`_DT2`[, .(ACTUAL_DEATHS = sum(ACTUAL_DEATHS), EXPECTED_DEATHS = sum(EXPECTED_DEATHS), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     EXPOSURE = sum(EXPOSURE), VARIANCE_DEATHS = sum(VARIANCE_DEATHS)), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     keyby = .(ATTAINED_AGE)][, `:=`(ACTUAL_TO_EXPECTED = ACTUAL_DEATHS/EXPECTED_DEATHS, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ACTUAL_TO_EXPOSED = ACTUAL_DEATHS/EXPOSURE, EXPECTED_TO_EXPOSED = EXPECTED_DEATHS/EXPOSURE)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ATTAINED_AGE ACTUAL_DEATHS EXPECTED_DEATHS EXPOSURE VARIANCE_DEATHS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>           19             0           0.214     21.7           0.214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>           20             0           0.565     56.5           0.565</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>           21             0           0.662     65.5           0.661</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>           22             0           0.713     69.9           0.712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>           23             0           0.828     80.3           0.827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span>           24             0           0.884     84.9           0.884</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 77 more rows, and 3 more variables: ACTUAL_TO_EXPECTED &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   ACTUAL_TO_EXPOSED &lt;dbl&gt;, EXPECTED_TO_EXPOSED &lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># Use as.data.table()/as.data.frame()/as_tibble() to access results</span></span>
<span class="r-in"></span>
<span class="r-in">   <span class="va">es</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">     <span class="fu"><a href="aggregate.html">aggregate</a></span><span class="op">(</span></span>
<span class="r-in">       <span class="va">UNDERWRITING_CLASS</span>,</span>
<span class="r-in">       <span class="va">GENDER</span>,</span>
<span class="r-in">       <span class="va">SMOKING_STATUS</span></span>
<span class="r-in">     <span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">     <span class="va">add_metrics</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Source: </span>local data table [12 x 10]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">Call:   </span>`_DT2`[, .(ACTUAL_DEATHS = sum(ACTUAL_DEATHS), EXPECTED_DEATHS = sum(EXPECTED_DEATHS), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     EXPOSURE = sum(EXPOSURE), VARIANCE_DEATHS = sum(VARIANCE_DEATHS)), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     keyby = .(UNDERWRITING_CLASS, GENDER, SMOKING_STATUS)][, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     `:=`(ACTUAL_TO_EXPECTED = ACTUAL_DEATHS/EXPECTED_DEATHS, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ACTUAL_TO_EXPOSED = ACTUAL_DEATHS/EXPOSURE, EXPECTED_TO_EXPOSED = EXPECTED_DEATHS/EXPOSURE)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   UNDERWRITING_CLA… GENDER SMOKING_STATUS ACTUAL_DEATHS EXPECTED_DEATHS EXPOSURE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> PREFERRED         FEMALE NON-SMOKER                 9            7.74     455.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> PREFERRED         FEMALE SMOKER                     3            2.86     171.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> PREFERRED         MALE   NON-SMOKER                17           10.7      679.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> PREFERRED         MALE   SMOKER                     7            4.48     274.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> SELECT            FEMALE NON-SMOKER                22           20.7     <span style="text-decoration: underline;">1</span>149.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> SELECT            FEMALE SMOKER                     8            7.68     453.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 6 more rows, and 4 more variables: VARIANCE_DEATHS &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   ACTUAL_TO_EXPECTED &lt;dbl&gt;, ACTUAL_TO_EXPOSED &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   EXPECTED_TO_EXPOSED &lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># Use as.data.table()/as.data.frame()/as_tibble() to access results</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Cody Buehler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

